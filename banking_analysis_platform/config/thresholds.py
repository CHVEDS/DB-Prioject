"""Pattern configuration for banking analysis platform."""

# Financial statement sections identifiers
STATEMENT_SECTIONS = [
    "balance_sheet",           # Balance Sheet
    "income_statement",       # Profit and Loss Statement
    "cash_flow",             # Cash Flow Statement
    "statement_of_changes_in_equity"  # Statement of Changes in Equity
]

# Patterns for finding financial indicators in Russian reports
FINANCIAL_INDICATOR_PATTERNS = {
    # Balance sheet items
    'total_assets': [
        r'итого активов',
        r'валюта баланса',
        r'активы всего',
        r'^активы$',
        r'активы.*конец',
        r'общие активы'
    ],
    'total_liabilities': [
        r'итого обязательств',
        r'обязательства всего',
        r'пассивы всего',
        r'общие обязательства'
    ],
    'equity': [
        r'собственный капитал',
        r'капитал и резервы',
        r'итого по разделу iv',
        r'уставный капитал',
        r'добавочный капитал',
        r'нераспределенная прибыль'
    ],
    'cash_and_equivalents': [
        r'денежные средства',
        r'касса',
        r'денежные средства в банках'
    ],
    'loans_to_customers': [
        r'кредиты и авансы клиентам',
        r'кредитный портфель',
        r'ссуды клиентам',
        r'выданные кредиты',
        r'кредиты.*физическим',
        r'кредиты.*юридическим'
    ],
    'deposits_from_customers': [
        r'депозиты',
        r'привлеченные средства',
        r'средства клиентов',
        r'обязательства.*клиентов',
        r'вклады'
    ],
    
    # Income statement items
    'net_income': [
        r'чистая прибыль',
        r'прибыль.*налог',
        r'прибыль за год',
        r'чистая прибыль.*год',
        r'прибыль.*отчетный период',
        r'итоговая прибыль'
    ],
    'operating_income': [
        r'операционный доход',
        r'операционные поступления',
        r'доходы от основной деятельности',
        r'доходы.*основная',
        r'выручка от реализации'
    ],
    'operating_profit': [
        r'операционная прибыль',
        r'прибыль от основной деятельности',
        r'прибыль до налогообложения'
    ],
    'net_interest_income': [
        r'чистый процентный доход',
        r'процентный доход.*чистый',
        r'nii'
    ],
    
    # Ratios and rates
    'roa': [
        r'roa',
        r'рентабельность активов',
        r'роа',
        r'рентабельность.*активов'
    ],
    'roe': [
        r'roe',
        r'рентабельность собственного капитала',
        r'роэ',
        r'рентабельность.*капитала'
    ],
    'net_interest_margin': [
        r'чистая процентная маржа',
        r'процентная маржа',
        r'npm',
        r'чистая.*маржа'
    ],
    'cost_to_income_ratio': [
        r'затраты к доходу',
        r'cir',
        r'отношение затрат к доходу',
        r'коэффициент затрат'
    ],
    'non_performing_loan_ratio': [
        r'неработающ.*кредит',
        r'npl',
        r'просрочен.*кредит',
        r'стадия 3',
        r'просроченная задолженность',
        r'нпл'
    ],
    'capital_adequacy_ratio': [
        r'коэффициент.*адекватности',
        r'базель',
        r'капитал.*уровень',
        r'cet1',
        r'базовый капитал'
    ],
    'current_liquidity_ratio': [
        r'текущая ликвидность',
        r'коэффициент текущей ликвидности',
        r'ликвидность.*текущая'
    ],
    'instant_liquidity_ratio': [
        r'мгновенная ликвидность',
        r'коэффициент мгновенной ликвидности',
        r'ликвидность.*мгновенная'
    ],
    
    # Digital banking metrics
    'digital_penetration': [
        r'доля цифровых клиентов',
        r'цифровая проницаемость',
        r'цифровые клиенты.*доля',
        r'цифровизация.*клиентов'
    ],
    'mobile_penetration': [
        r'мобильная проницаемость',
        r'доля мобильных клиентов',
        r'мобильный банкинг.*доля',
        r'мобильные.*клиенты'
    ],
    'active_digital_customers': [
        r'активные цифровые клиенты',
        r'mau',
        r'активные пользователи',
        r'активные клиенты.*мобильный',
        r'активные.*цифровые'
    ],
    
    # Operational metrics
    'number_of_branches': [
        r'количество отделений',
        r'число отделений',
        r'сеть отделений',
        r'отделения и филиалы.*количество',
        r'офисы.*количество'
    ],
    'it_staff': [
        r'it-персонал',
        r'технический персонал',
        r'it staff',
        r'сотрудники.*информационные технологии',
        r'специалисты.*ит'
    ],
    'api_count': [
        r'api',
        r'интерфейс прикладного программирования',
        r'открытые api',
        r'api.*интеграция'
    ],
    'paperless_operations': [
        r'безбумажный',
        r'безбумажные операции',
        r'безбумажные процессы',
        r'электронный документооборот'
    ],
    'electronic_signature_usage': [
        r'электронная подпись',
        r'цифровая подпись',
        r'e-подпись',
        r'эцп',
        r'электронно-цифровая подпись'
    ],
    'remote_account_opening': [
        r'удаленное открытие счета',
        r'дистанционное открытие счета',
        r'онлайн-открытие счета',
        r'цифровое открытие счета'
    ],
    'churn_rate': [
        r'коэффициент оттока',
        r'отток клиентов',
        r'churn',
        r'отток.*клиенты'
    ],
    'retention_rate': [
        r'коэффициент удержания',
        r'удержание клиентов',
        r'лояльность',
        r'удержание.*клиенты'
    ],
    'products_per_customer': [
        r'продукты на клиента',
        r'количество продуктов на клиента',
        r'среднее число продуктов',
        r'продуктовая.*корзина'
    ],
    'cross_sell_rate': [
        r'кросс-продажи',
        r'перекрестные продажи',
        r'дополнительные продукты',
        r'кросс.*продажи'
    ],
    'wallet_share': [
        r'доля кошелька',
        r'рыночная доля',
        r'доля рынка',
        r'кошелек.*клиента'
    ],
    'credit_cost': [
        r'стоимость кредитов',
        r'стоимость риска',
        r'кор',
        r'резервы.*кредитные убытки',
        r'стоимость.*кредитования'
    ],
    'loan_loss_provision_coverage': [
        r'резервы под кредитные убытки к проблемным кредитам',
        r'коэффициент резервирования',
        r'покрытие нпл резервами',
        r'резервы.*нпл'
    ],
    'subordinated_debt': [
        r'субординированный долг',
        r'субординированные обязательства'
    ],
    'interest_earning_assets': [
        r'процентные активы',
        r'доходные активы'
    ],
    'interest_bearing_liabilities': [
        r'процентные обязательства',
        r'доходные обязательства'
    ],
    'net_interest_spread': [
        r'процентный спред',
        r'разница ставок'
    ],
    'interbank_assets': [
        r'межбанковские активы',
        r'активы.*межбанк'
    ],
    'interbank_liabilities': [
        r'межбанковские обязательства',
        r'обязательства.*межбанк'
    ],
    'equity_to_debt_ratio': [
        r'соотношение собственного капитала к заемному',
        r'капитал.*долг'
    ],
    'retained_earnings_to_total_assets': [
        r'соотношение нераспределенной прибыли к активам',
        r'нераспределенная прибыль.*активы'
    ],
    'ebit_to_total_assets': [
        r'соотношение прибыли до вычета процентов и налогов к активам',
        r'ebit.*активы'
    ],
    'total_assets_turnover': [
        r'оборачиваемость активов',
        r'оборот активов'
    ],
    'return_on_net_assets': [
        r'рентабельность чистых активов',
        r'рна'
    ],
    'return_on_average_total_assets': [
        r'рентабельность средних активов',
        r'рсна'
    ],
    'return_on_net_assets_after_deducting_non_recurring': [
        r'рентабельность чистых активов после исключения разовых факторов',
        r'рнапосле'
    ],
    'interbank_assets_to_interest_earning_assets': [
        r'соотношение межбанковских активов к процентным активам',
        r'межбанк.*доходные активы'
    ],
    'deposits_to_interest_bearing_liabilities': [
        r'соотношение депозитов к процентным обязательствам',
        r'депозиты.*процентные обязательства'
    ],
    'interbank_liabilities_to_interest_bearing_liabilities': [
        r'соотношение межбанковских обязательств к процентным обязательствам',
        r'межбанк.*процентные обязательства'
    ]
}

# Unit conversion patterns
UNIT_PATTERNS = [
    (r'млрд\\.?\\s*р\\.?', 1e9),
    (r'млрд\\.?\\s*руб\\.?', 1e9),
    (r'млрд', 1e9),
    (r'млн\\.?\\s*р\\.?', 1e6),
    (r'млн\\.?\\s*руб\\.?', 1e6),
    (r'млн', 1e6),
    (r'тыс\\.?\\s*р\\.?', 1e3),
    (r'тыс\\.?\\s*руб\\.?', 1e3),
    (r'тыс', 1e3)
]

# Supported file formats
SUPPORTED_FORMATS = ['.pdf', '.docx', '.txt', '.md']

# Thresholds for ratios
RATIO_THRESHOLDS = {
    # Capital Adequacy (Basel III simplified)
    "capital_adequacy_ratio": (0.08, 0.12),  # Min 8%, Ideal 12%
    
    # Liquidity ratios
    "instant_liquidity_ratio": (0.15, 0.25),  # Min 15%, Ideal 25% 
    "current_liquidity_ratio": (1.0, 1.5),    # Min 1.0, Ideal 1.5
    
    # Profitability ratios
    "roe": (0.10, 0.15),                # Min 10%, Ideal 15%
    "roa": (0.01, 0.02),                # Min 1%, Ideal 2%
    "net_interest_margin": (0.02, 0.04), # Min 2%, Ideal 4%
    
    # Asset quality ratio
    "non_performing_loan_ratio": (0.05, 0.02) # Max 5%, Ideal 2% (reverse threshold)
}